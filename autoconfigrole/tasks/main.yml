---
- name: Render template
  template:
    src: templates/{{ template }}
    dest: renderedconfigs/{{ hostname }}

- name: Logging Sync
  ios_config: 
    lines: logging sync
    parents: line vty 0 4

- name: Deploy Configuration File
  ios_command:
    commands: 
    - command: 'copy scp: startup-config'
      check_all: True
      prompt:
        - 'Address'
        - 'Source username'
        - 'Source filename'
        - 'Destination filename'
        - 'Password'
      answer:
        - '10.22.78.10'
        - '{{ linux_user }}'
        - '/home/{{ linux_user }}/CNIT450Ansible/renderedconfigs/{{ hostname }}'
        - ''
        - '{{ scp_password }}'

- name: Reboot Device
  ios_command:
    commands: 
    - command: 'reload'
      check_all: True
      prompt:
        - 'Save'
        - 'confirm'
      answer:
        - 'n'
        - ''

- name: Wait for Reboot
  wait_for_connection:
    delay: 10
    timeout: 1200
  vars:
    ansible_command_timeout: 1200

- name: Reboot Device
  ios_command:
    commands: 'wr'
